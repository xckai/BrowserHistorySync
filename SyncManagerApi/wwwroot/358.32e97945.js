(globalThis.webpackChunkreact_simple=globalThis.webpackChunkreact_simple||[]).push([[358],{24390:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>P}),a(83861);var n=a(22517),l=(a(79666),a(25918)),r=a(62632),i=a(50603),o=a(16131),c=a(23146),s=a(34812),d=a(73763),u=a(55495),m=(a(51676),a(94350)),g=(a(55726),a(14042)),p=(a(45702),a(16623)),f=(a(2409),a(38466)),y=(a(96680),a(85460)),h=(a(51216),a(37426)),E=a(50619),w=a.n(E),S=a(29840),b=a.n(S),k=a(17854),C=a(59907);const v=d.ZP.p.withConfig({displayName:"BrowserHistoryManager__StyledP",componentId:"sc-z4ki3j-0"})(["margin:0;padding:0;max-width:40rem;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;display:flex;align-items:center;img{width:1rem;height:1rem;margin-right:0.3rem;}"]);function x(){const[e,t]=(0,r.useState)([]),[a,n]=(0,r.useState)(!1),[l,i]=(0,r.useState)({keyword:"",datetimeFrom:b()().subtract(7,"days").hours(0).minute(0).second(0).millisecond(0),datetimeTo:b()().hours(23).minute(59).second(59).millisecond(0)}),[o,c]=(0,r.useState)([]),[s,d]=(0,r.useState)({current:1,pageSize:15,size:"default",showTotal:e=>w()("共 ${total} 条记录")({total:e})}),[u]=h.Z.useForm();function E(e){n(!0),k.K.queryHistoryList(e).then((e=>{d({...s,total:e.data.total,pageSize:e.data.pageSize,current:e.data.current}),t(e.data?.data),n(!1)})).catch((e=>{console.error(e),y.default.error(e.message),n(!1)})).finally((()=>{n(!1)}))}(0,r.useEffect)((()=>{E({...l,pageSize:s.pageSize,pageIndex:s.current})}),[]);const S=(0,r.useCallback)(((e,a,r)=>{n(!0),d({...s,pageSize:e.pageSize,current:e.current,total:e.total}),t([]),E({...l,pageIndex:e.current,pageSize:e.pageSize})}),[d,n,l]),x=(0,r.useCallback)((e=>{i({...l,keyword:e.target.value})}),[l]),Z=(0,r.useCallback)((e=>{i({...l,datetimeFrom:e[0]?.hour(0).minute(0).second(0),datetimeTo:e[1].hour(23).minute(59).second(59)})}),[l]),z=(0,r.useCallback)((()=>{E({...l,pageSize:s.pageSize,pageIndex:s.current})}),[l,s]),H=(0,r.useCallback)((()=>{n(!0),k.K.batchDeleteHistoryItem(o).then((e=>{y.default.success("删除成功"),c([]),E({...l,pageSize:s.pageSize,pageIndex:s.current})})).catch((e=>{y.default.error(e.message)})).finally((()=>{n(!1)}))}),[o,l,s]),F={selectedRowKeys:o,onChange:c},D=[{title:"Title",dataIndex:"title",render:(e,t)=>r.createElement(v,{title:e},r.createElement("img",{src:t.faviconUrl,alt:""}),r.createElement("a",{target:"_blank",href:t.url},e))},{title:"Url",dataIndex:"url",render:e=>r.createElement(v,{title:e},e)},{title:"设备名称",dataIndex:"equipmentName",render:e=>r.createElement("span",null,e)},{title:"访问时间",dataIndex:"timestamp",render:e=>b()(e).format("YYYY/MM/DD HH:mm:ss"),columnWidth:"30rem"}];return r.createElement("section",null,r.createElement(I,null,r.createElement(h.Z,{layout:"inline",form:u},r.createElement(h.Z.Item,{label:"关键字"},r.createElement(f.default,{allowClear:!0,placeholder:"请输入关键字",width:200,value:l.keyword,onChange:x,onPressEnter:z})),r.createElement(h.Z.Item,{label:"时间范围"},r.createElement(p.Z.RangePicker,{locale:C.Z,value:[l.datetimeFrom,l.datetimeTo],onChange:Z,disabledDate:e=>e&&e>b()().endOf("day")})),r.createElement(h.Z.Item,null,r.createElement(g.default,{type:"primary",onClick:z,loading:a},"搜索"))),r.createElement(g.default,{danger:!0,onClick:H,loading:a,disabled:!(o&&o.length>0)},o&&o.length>0?`删除${o.length} 条记录`:"删除")),r.createElement(m.Z,{size:"small",columns:D,rowKey:e=>e.id,rowSelection:F,dataSource:e,pagination:s,loading:a,onChange:S}))}var I=(0,d.ZP)("div").withConfig({displayName:"BrowserHistoryManager___StyledDiv",componentId:"sc-z4ki3j-1"})(["padding:0 0 8px 0;display:flex;justify-content:space-between;"]),Z=(a(45877),a(10908)),z=(a(14850),a(97554)),H=a(52993),F=a.n(H);const D=new class{async getAllRules(e,t){return F().get(`${window.syncManagerConfig?.dataServerUrl??""}/api/FilterRule/Query`,{params:{pageIndex:e,pageSize:t}})}async delete(e){return F().delete(`${window.syncManagerConfig?.dataServerUrl??""}/api/FilterRule?ruleId=`+e)}async create(e){return F().put(`${window.syncManagerConfig?.dataServerUrl??""}/api/FilterRule`,e)}async update(e){return F().patch(`${window.syncManagerConfig?.dataServerUrl??""}/api/FilterRule`,e)}};function T(){const[e,t]=(0,r.useState)([]),[a,n]=(0,r.useState)(!1),[l,i]=(0,r.useState)(""),[o]=h.Z.useForm(),[c,s]=(0,r.useState)({current:1,pageSize:10,showTotal:e=>w()("共 ${total} 条记录")({total:e})});function d(e=1,a=10){n(!0),D.getAllRules(e,a).then((e=>{s({...c,total:e.data.total,pageSize:e.data.pageSize,current:e.data.current}),t(e.data?.data),n(!1)})).catch((e=>{console.error(e),y.default.error(e.message),n(!1)})).finally((()=>{n(!1)}))}(0,r.useEffect)((()=>{d(c.current,c.pageSize)}),[]);const u=(0,r.useCallback)((e=>{z.Z.confirm({content:"确定删除",onOk:()=>{D.delete(e).then((e=>{y.default.success("删除成功"),d(c.current,c.pageSize)})).catch((e=>{console.error(e),y.default.error(e.message),n(!1)})).finally((()=>{n(!1)}))}})}),[c,d,n]),p=(0,r.useCallback)((e=>{D.create(e).then((e=>{y.default.success("创建过滤规则成功"),i(""),o.setFieldsValue({}),d(c.current,c.pageSize)})).catch((e=>{console.error(e),y.default.error(e.message),n(!1)})).finally((()=>{n(!1)}))}),[o,l,c,i]),E=(0,r.useCallback)((e=>{D.update(e).then((e=>{y.default.success("更新过滤规则成功"),i(""),o.setFieldsValue({}),d(c.current,c.pageSize)})).catch((e=>{console.error(e),y.default.error(e.message),n(!1)})).finally((()=>{n(!1)}))}),[c,i,o]),S=[{title:"ID",render:(e,t,a)=>a+1},{title:"规则类型",dataIndex:"ruleType"},{title:"Value",dataIndex:"value"},{title:"操作",render:(e,t)=>r.createElement(g.default.Group,null,r.createElement(g.default,{type:"link",onClick:()=>{i("edit"),o.setFieldsValue(t)}},"编辑"),r.createElement(g.default,{type:"link",danger:!0,onClick:()=>u(t.id)},"删除"))}];return r.createElement("section",null,r.createElement(U,null,r.createElement("div",null),r.createElement(g.default,{type:"primary",loading:a,onClick:()=>{i("create"),o.resetFields(),o.setFieldsValue({ruleType:"Domain"})}},"新增")),r.createElement(m.Z,{columns:S,rowKey:e=>e.id,dataSource:e,pagination:c,loading:a}),r.createElement(z.Z,{onCancel:()=>i(""),visible:"edit"==l||"create"==l,title:"edit"==l?"编辑过滤规则":"新增过滤规则",onOk:()=>{o.validateFields().then((e=>{"edit"==l?E(e):p(e)})).catch((e=>{console.error(e)}))}},r.createElement(h.Z,{labelCol:{span:8},wrapperCol:{span:12},form:o},r.createElement(h.Z.Item,{label:"过滤规则类型",name:"ruleType",rules:[{required:!0,message:"请选择"}]},r.createElement(Z.default,null,r.createElement(Z.default.Option,{value:"Domain"},"Domain"),r.createElement(Z.default.Option,{value:"DomainKeyword"},"DomainKeyword"),r.createElement(Z.default.Option,{value:"DomainSuffix"},"DomainSuffix"))),r.createElement(h.Z.Item,{label:"值",rules:[{required:!0,message:"请输入"}],name:"value"},r.createElement(f.default,null)),r.createElement(h.Z.Item,{name:"id",hidden:!0},r.createElement(f.default,null)))))}var U=(0,d.ZP)("div").withConfig({displayName:"FilterRuleManager___StyledDiv",componentId:"sc-14caf2r-0"})(["padding:0 0 8px 0;display:flex;justify-content:space-between;"]),_=a(79122),M=(a(83907),a(93650)),N=a(59566);function R(){const e=(0,_.TH)().pathname.split("/").filter((e=>e)),t={"/admin/browserHistory":"浏览历史管理","/admin/filterRule":"过滤规则配置"},a=e.map(((a,n)=>{const l=`/${e.slice(0,n+1).join("/")}`;return r.createElement(M.Z.Item,{key:l},r.createElement(N.rU,{to:l},t[l]))}));return r.createElement(M.Z,{separator:""},a)}const{Header:O,Sider:$,Content:j}=l.Z,K=(0,d.ZP)(l.Z).withConfig({displayName:"Index__StyledLayout",componentId:"sc-1aag0bm-0"})(["height:100vh;width:100vw;.trigger{padding:0 24px;font-size:18px;line-height:64px;cursor:pointer;transition:color 0.3s;}.trigger:hover{color:#1890ff;}.logo{height:2rem;display:flex;justify-content:center;align-items:center;img{height:1.5rem;width:1.5rem;}span{font-size:90%;font-weight:bold;letter-spacing:0.0625em;color:#eee;}margin:16px;}.site-layout .site-layout-background{background:#fff;}.site-layout{.header{display:flex;align-items:center;}}"]);function P(){const[e,t]=(0,r.useState)(!0),a=(0,_.s0)();(0,r.useEffect)((()=>{window.document.title="BrowserHistorySync Admin"}),[]);const d=(0,_.TH)();return r.createElement(K,null,r.createElement($,{collapsedWidth:80,trigger:null,collapsible:!0,collapsed:e},r.createElement("div",{className:"logo"},r.createElement("img",{src:u.Z,alt:""}),!e&&r.createElement("span",null,"BrowserHistorySync")),r.createElement(n.default,{theme:"dark",mode:"inline",defaultSelectedKeys:[d.pathname],items:[{key:"/admin/browserHistory",icon:r.createElement(i.Z,null),label:"浏览历史管理",onClick:()=>{a("./browserHistory")}},{key:"/admin/filterRule",icon:r.createElement(o.Z,null),label:"过滤规则配置",onClick:()=>{a("./filterRule")}}]})),r.createElement(l.Z,{className:"site-layout"},r.createElement(O,{className:"site-layout-background header",style:{padding:0}},r.createElement(e?c.Z:s.Z,{className:"trigger",onClick:()=>t(!e)}),r.createElement(R,null)),r.createElement(j,{className:"site-layout-background",style:{overflow:"auto",margin:"24px 16px",padding:24,minHeight:280}},r.createElement(_.Z5,null,r.createElement(_.AW,{path:"browserHistory",element:r.createElement(x,null)}),r.createElement(_.AW,{path:"filterRule",element:r.createElement(T,null)}),r.createElement(_.AW,{path:"",element:r.createElement(x,null)})))))}},17854:(e,t,a)=>{"use strict";a.d(t,{K:()=>r});var n=a(52993),l=a.n(n);const r=new class{async queryHistoryList(e){return console.log(e,"searchParam"),l().get(`${window.syncManagerConfig?.dataServerUrl??""}/api/UrlHistory/Query`,{params:{pageIndex:e.pageIndex??1,pageSize:e.pageSize??15,keyword:e.keyword,dateFrom:e?.datetimeFrom?.toISOString(),dateTo:e?.datetimeTo?.toISOString(),equipments:e?.equipmentName}})}async deleteHistoryItem(e){return l().delete(`${window.syncManagerConfig?.dataServerUrl??""}/api/UrlHistory?id=${e}`)}async batchDeleteHistoryItem(e){return l().delete(`${window.syncManagerConfig?.dataServerUrl??""}/api/UrlHistory/BatchDelete`,{data:e})}}},55495:(e,t,a)=>{"use strict";a.d(t,{Z:()=>n});const n=a.p+"851378514f50d38c2b60bb0769a84f14.png"},22157:(e,t,a)=>{var n={"./en-gb":37067,"./en-gb.js":37067,"./zh-cn":5327,"./zh-cn.js":5327};function l(e){var t=r(e);return a(t)}function r(e){if(!a.o(n,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return n[e]}l.keys=function(){return Object.keys(n)},l.resolve=r,e.exports=l,l.id=22157}}]);