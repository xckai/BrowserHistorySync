(globalThis.webpackChunkreact_simple=globalThis.webpackChunkreact_simple||[]).push([[358],{24390:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>B}),a(55726);var l=a(14042),n=(a(83861),a(22517)),r=(a(79666),a(25918)),i=a(62632),o=a(50603),s=a(16131),c=a(23146),d=a(34812),u=a(95811),m=a(69993),p=a(73763),g=a(55495),f=(a(51676),a(94350)),h=(a(45702),a(16623)),y=(a(2409),a(38466)),E=(a(96680),a(85460)),w=(a(51216),a(37426)),b=a(50619),S=a.n(b),k=a(29840),C=a.n(k),x=a(17854),v=a(59907);const Z=p.ZP.p.withConfig({displayName:"BrowserHistoryManager__StyledP",componentId:"sc-z4ki3j-0"})(["margin:0;padding:0;max-width:30rem;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;display:flex;align-items:center;img{width:1rem;height:1rem;margin-right:0.3rem;}"]);function I(){const[e,t]=(0,i.useState)([]),[a,n]=(0,i.useState)(!1),[r,o]=(0,i.useState)({keyword:"",datetimeFrom:C()().subtract(7,"days").hours(0).minute(0).second(0).millisecond(0),datetimeTo:C()().hours(23).minute(59).second(59).millisecond(0)}),[s,c]=(0,i.useState)([]),[d,u]=(0,i.useState)({current:1,pageSize:15,size:"default",showTotal:e=>S()("共 ${total} 条记录")({total:e})}),[m]=w.Z.useForm();function p(e){n(!0),x.K.queryHistoryList(e).then((e=>{u({...d,total:e.data.total,pageSize:e.data.pageSize,current:e.data.current}),t(e.data?.data),n(!1)})).catch((e=>{console.error(e),E.default.error(e.message),n(!1)})).finally((()=>{n(!1)}))}(0,i.useEffect)((()=>{p({...r,pageSize:d.pageSize,pageIndex:d.current})}),[]);const g=(0,i.useCallback)(((e,a,l)=>{n(!0),u({...d,pageSize:e.pageSize,current:e.current,total:e.total}),t([]),p({...r,pageIndex:e.current,pageSize:e.pageSize})}),[u,n,r]),b=(0,i.useCallback)((e=>{o({...r,keyword:e.target.value})}),[r]),k=(0,i.useCallback)((e=>{o({...r,datetimeFrom:e[0]?.hour(0).minute(0).second(0),datetimeTo:e[1].hour(23).minute(59).second(59)})}),[r]),I=(0,i.useCallback)((()=>{p({...r,pageSize:d.pageSize,pageIndex:d.current})}),[r,d]),H=(0,i.useCallback)((()=>{n(!0),x.K.batchDeleteHistoryItem(s).then((e=>{E.default.success("删除成功"),c([]),p({...r,pageSize:d.pageSize,pageIndex:d.current})})).catch((e=>{E.default.error(e.message)})).finally((()=>{n(!1)}))}),[s,r,d]),F={selectedRowKeys:s,onChange:c},D=[{title:"Title",dataIndex:"title",render:(e,t)=>i.createElement(Z,{title:e},i.createElement("img",{src:t.faviconUrl,alt:""}),i.createElement("a",{target:"_blank",href:t.url},e))},{title:"Url",dataIndex:"url",render:e=>i.createElement(Z,{title:e},e)},{title:"设备名称",dataIndex:"equipmentName",render:e=>i.createElement("span",null,e)},{title:"访问时间",dataIndex:"timestamp",render:e=>C()(e).format("YYYY/MM/DD HH:mm:ss")}];return i.createElement("section",null,i.createElement(z,null,i.createElement(w.Z,{layout:"inline",form:m},i.createElement(w.Z.Item,{label:"关键字"},i.createElement(y.default,{allowClear:!0,placeholder:"请输入关键字",width:200,value:r.keyword,onChange:b,onPressEnter:I})),i.createElement(w.Z.Item,{label:"时间范围"},i.createElement(h.Z.RangePicker,{locale:v.Z,value:[r.datetimeFrom,r.datetimeTo],onChange:k,disabledDate:e=>e&&e>C()().endOf("day")})),i.createElement(w.Z.Item,null,i.createElement(l.default,{type:"primary",onClick:I,loading:a},"搜索"))),i.createElement(l.default,{danger:!0,onClick:H,loading:a,disabled:!(s&&s.length>0)},s&&s.length>0?`删除${s.length} 条记录`:"删除")),i.createElement(f.Z,{size:"small",columns:D,rowKey:e=>e.id,rowSelection:F,dataSource:e,pagination:d,loading:a,onChange:g}))}var z=(0,p.ZP)("div").withConfig({displayName:"BrowserHistoryManager___StyledDiv",componentId:"sc-z4ki3j-1"})(["padding:0 0 8px 0;display:flex;justify-content:space-between;"]),H=(a(45877),a(10908)),F=(a(14850),a(97554)),D=a(64221);class N extends D.d{async getAllRules(e,t){return this.axiosClient.get("/api/FilterRule/Query",{params:{pageIndex:e,pageSize:t}})}async delete(e){return this.axiosClient.delete("/api/FilterRule?ruleId="+e)}async create(e){return this.axiosClient.put("/api/FilterRule",e)}async update(e){return this.axiosClient.patch("/api/FilterRule",e)}}const T=new N;function _(){const[e,t]=(0,i.useState)([]),[a,n]=(0,i.useState)(!1),[r,o]=(0,i.useState)(""),[s]=w.Z.useForm(),[c,d]=(0,i.useState)({current:1,pageSize:10,showTotal:e=>S()("共 ${total} 条记录")({total:e})});function u(e=1,a=10){n(!0),T.getAllRules(e,a).then((e=>{d({...c,total:e.data.total,pageSize:e.data.pageSize,current:e.data.current}),t(e.data?.data),n(!1)})).catch((e=>{console.error(e),console.log(e.response),E.default.error(e.message),n(!1)})).finally((()=>{n(!1)}))}(0,i.useEffect)((()=>{u(c.current,c.pageSize)}),[]);const m=(0,i.useCallback)((e=>{F.Z.confirm({content:"确定删除",onOk:()=>{T.delete(e).then((e=>{E.default.success("删除成功"),u(c.current,c.pageSize)})).catch((e=>{console.error(e),E.default.error(e.message),n(!1)})).finally((()=>{n(!1)}))}})}),[c,u,n]),p=(0,i.useCallback)((e=>{T.create(e).then((e=>{E.default.success("创建过滤规则成功"),o(""),s.setFieldsValue({}),u(c.current,c.pageSize)})).catch((e=>{console.error(e),E.default.error(e.message),n(!1)})).finally((()=>{n(!1)}))}),[s,r,c,o]),g=(0,i.useCallback)((e=>{T.update(e).then((e=>{E.default.success("更新过滤规则成功"),o(""),s.setFieldsValue({}),u(c.current,c.pageSize)})).catch((e=>{console.error(e),E.default.error(e.message),n(!1)})).finally((()=>{n(!1)}))}),[c,o,s]),h=[{title:"ID",render:(e,t,a)=>a+1},{title:"规则类型",dataIndex:"ruleType"},{title:"Value",dataIndex:"value"},{title:"操作",render:(e,t)=>i.createElement(l.default.Group,null,i.createElement(l.default,{type:"link",onClick:()=>{o("edit"),s.setFieldsValue(t)}},"编辑"),i.createElement(l.default,{type:"link",danger:!0,onClick:()=>m(t.id)},"删除"))}];return i.createElement("section",null,i.createElement(P,null,i.createElement("div",null),i.createElement(l.default,{type:"primary",loading:a,onClick:()=>{o("create"),s.resetFields(),s.setFieldsValue({ruleType:"Domain"})}},"新增")),i.createElement(f.Z,{columns:h,rowKey:e=>e.id,dataSource:e,pagination:c,loading:a}),i.createElement(F.Z,{onCancel:()=>o(""),visible:"edit"==r||"create"==r,title:"edit"==r?"编辑过滤规则":"新增过滤规则",onOk:()=>{s.validateFields().then((e=>{"edit"==r?g(e):p(e)})).catch((e=>{console.error(e)}))}},i.createElement(w.Z,{labelCol:{span:8},wrapperCol:{span:12},form:s},i.createElement(w.Z.Item,{label:"过滤规则类型",name:"ruleType",rules:[{required:!0,message:"请选择"}]},i.createElement(H.default,null,i.createElement(H.default.Option,{value:"Domain"},"Domain"),i.createElement(H.default.Option,{value:"DomainKeyword"},"DomainKeyword"),i.createElement(H.default.Option,{value:"DomainSuffix"},"DomainSuffix"))),i.createElement(w.Z.Item,{label:"值",rules:[{required:!0,message:"请输入"}],name:"value"},i.createElement(y.default,null)),i.createElement(w.Z.Item,{name:"id",hidden:!0},i.createElement(y.default,null)))))}var P=(0,p.ZP)("div").withConfig({displayName:"FilterRuleManager___StyledDiv",componentId:"sc-14caf2r-0"})(["padding:0 0 8px 0;display:flex;justify-content:space-between;"]),R=a(59566),j=a(79122),O=(a(83907),a(93650));function A(){const e=(0,j.TH)().pathname.split("/").filter((e=>e)),t={"/admin/browserHistory":"浏览历史管理","/admin/filterRule":"过滤规则配置"},a=e.map(((a,l)=>{const n=`/${e.slice(0,l+1).join("/")}`;return i.createElement(O.Z.Item,{key:n},i.createElement(R.rU,{to:n},t[n]))}));return i.createElement(O.Z,{separator:""},a)}const{Header:U,Sider:K,Content:M}=r.Z,q=(0,p.ZP)(r.Z).withConfig({displayName:"Index__StyledLayout",componentId:"sc-1aag0bm-0"})(["height:100vh;width:100vw;.trigger{padding:0 24px;font-size:18px;line-height:64px;cursor:pointer;transition:color 0.3s;}.trigger:hover{color:#1890ff;}.logo{height:2rem;display:flex;justify-content:center;align-items:center;img{height:1.5rem;width:1.5rem;}span{font-size:90%;font-weight:bold;letter-spacing:0.0625em;color:#eee;}margin:16px;}.site-layout .site-layout-background{background:#fff;}.site-layout{.header{display:flex;align-items:center;justify-content:space-between;.left{display:flex;align-items:center;}.right{margin-right:1rem;button{margin:0 .3rem;}.logout{&:hover{color:red;border-color:red;}}}}}"]);function B(){const[e,t]=(0,i.useState)(!0),a=(0,j.s0)();(0,i.useEffect)((()=>{window.document.title="BrowserHistorySync Admin"}),[]);const p=(0,j.TH)();return i.createElement(q,null,i.createElement(K,{collapsedWidth:80,trigger:null,collapsible:!0,collapsed:e},i.createElement("div",{className:"logo"},i.createElement("img",{src:g.Z,alt:""}),!e&&i.createElement("span",null,"BrowserHistorySync")),i.createElement(n.default,{theme:"dark",mode:"inline",defaultSelectedKeys:[p.pathname],items:[{key:"/admin/browserHistory",icon:i.createElement(o.Z,null),label:"浏览历史管理",onClick:()=>{a("./browserHistory")}},{key:"/admin/filterRule",icon:i.createElement(s.Z,null),label:"过滤规则配置",onClick:()=>{a("./filterRule")}}]})),i.createElement(r.Z,{className:"site-layout"},i.createElement(U,{className:"site-layout-background header",style:{padding:0}},i.createElement("div",{className:"left"},i.createElement(e?c.Z:d.Z,{className:"trigger",onClick:()=>t(!e)}),i.createElement(A,null)),i.createElement("div",{className:"right"},i.createElement(R.rU,{to:"/"},i.createElement(l.default,{className:"home",icon:i.createElement(u.Z,null),shape:"circle"})),i.createElement(l.default,{className:"logout",icon:i.createElement(m.Z,null),onClick:D.k.logout,shape:"circle"}))),i.createElement(M,{className:"site-layout-background",style:{overflow:"auto",margin:"24px 16px",padding:24,minHeight:280}},i.createElement(j.Z5,null,i.createElement(j.AW,{path:"browserHistory",element:i.createElement(I,null)}),i.createElement(j.AW,{path:"filterRule",element:i.createElement(_,null)}),i.createElement(j.AW,{path:"",element:i.createElement(I,null)})))))}},64221:(e,t,a)=>{"use strict";a.d(t,{d:()=>f,k:()=>h}),a(51216);var l=a(37426),n=(a(2409),a(38466)),r=(a(14850),a(97554)),i=(a(96680),a(85460)),o=a(73763),s=a(62632),c=a(58960),d=a(52993),u=a.n(d);let m="";window.syncManagerConfig.env="prod",window.syncManagerConfig?.endpoints&&(m=window.syncManagerConfig?.endpoints.prod),u().defaults.baseURL=m??"",u().defaults.withCredentials=!0;let p="";const g=(0,s.createRef)();u().interceptors.response.use((e=>e),(e=>{const t=e.response;if(t)switch(t.status){case 400:return i.default.error(t.data??e.message),Promise.reject(e);case 401:return r.Z.confirm({title:"授权失败，请重新登录",okText:"登录",closable:!1,keyboard:!1,centered:!0,cancelButtonProps:{hidden:!0},onCancel:()=>{window.location.reload()},content:s.createElement(y,null,s.createElement(l.Z.Item,{label:"请输入密码",rules:[{required:!0,message:"Please input your username!"}]},s.createElement(n.default,{ref:g,onChange:({target:{value:e}})=>{p=e},type:"password"}))),icon:s.createElement(c.Z,{style:{color:"#ed1506"}}),onOk:()=>new Promise(((e,t)=>{(new f).login(p).then((t=>{e("ok"),window.location.reload()})).catch((e=>{t(!1)})),g.current.value=""}))}),Promise.reject(e);default:return i.default.error(e.message),Promise.reject(e)}return i.default.error(e.message),Promise.reject(e)}));class f{axiosClient=u();login(e){return u().post("api/Auth/login",`secret=${e}`)}logout(){return u().post("api/Auth/logout").then((e=>{i.default.info("成功登出，您可以关闭该页面"),setTimeout(window.close,2e3)}))}}const h=new f;var y=(0,o.ZP)(l.Z).withConfig({displayName:"baseAuthAxiosService___StyledForm",componentId:"sc-1f7ps0a-0"})(["margin-top:3rem;"])},17854:(e,t,a)=>{"use strict";a.d(t,{K:()=>r});var l=a(64221);class n extends l.d{async queryHistoryList(e){return console.log(e,"searchParam"),this.axiosClient.get("/api/UrlHistory/Query",{params:{pageIndex:e.pageIndex??1,pageSize:e.pageSize??15,keyword:e.keyword,dateFrom:e?.datetimeFrom?.toISOString(),dateTo:e?.datetimeTo?.toISOString(),equipments:e?.equipmentName}})}async deleteHistoryItem(e){return this.axiosClient.delete(`/api/UrlHistory?id=${e}`)}async batchDeleteHistoryItem(e){return this.axiosClient.delete("/api/UrlHistory/BatchDelete",{data:e})}}const r=new n},55495:(e,t,a)=>{"use strict";a.d(t,{Z:()=>l});const l=a.p+"851378514f50d38c2b60bb0769a84f14.png"},22157:(e,t,a)=>{var l={"./en-gb":37067,"./en-gb.js":37067,"./zh-cn":5327,"./zh-cn.js":5327};function n(e){var t=r(e);return a(t)}function r(e){if(!a.o(l,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return l[e]}n.keys=function(){return Object.keys(l)},n.resolve=r,e.exports=n,n.id=22157}}]);